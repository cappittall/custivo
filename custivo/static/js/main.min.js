function setFullScreen(e){const t=window.devicePixelRatio||1;e.width=t*window.innerWidth,e.height=t*window.innerHeight}function is_mobileOrTablet(){let e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e}function main(){_state=_states.loading;const e=document.getElementById("handTrackerCanvas"),t=document.getElementById("VTOCanvas");setFullScreen(e),setFullScreen(t);const n=_settings.models[_settings.initialModel];_VTOMode=n.VTOMode;const i=_settings.VTOModes[_VTOMode];set_canvasMirroring(!is_mobileOrTablet()),HandTrackerThreeHelper.init({stabilizationSettings:{},videoSettings:get_videoSettings(),landmarksStabilizerSpec:i.landmarksStabilizerSpec,objectPointsPositionFactors:i.objectPointsPositionFactors,poseLandmarksLabels:i.poseLandmarksLabels,poseFilter:i.isPoseFilter?PoseFlipFilter.instance({}):null,NNsPaths:i.NNsPaths,threshold:i.threshold,VTOCanvas:t,callbackTrack:callbackTrack,handTrackerCanvas:e,debugDisplayLandmarks:_settings.debugDisplayLandmarks}).then(start).catch(function(e){throw new Error(e)})}function setup_lighting(e){const t=e.scene,n=new THREE.HemisphereLight(16777215,0,2);t.add(n);const i=new THREE.PointLight(16777215,2);i.position.set(0,100,0),t.add(i)}function change_VTOMode(e){console.log("INFO in main.js - change_VTOMode(): change VTO Mode to ",e),HandTrackerThreeHelper.clear_threeObjects(!0);const t=_settings.VTOModes[e];return HandTrackerThreeHelper.update({landmarksStabilizerSpec:t.landmarksStabilizerSpec,objectPointsPositionFactors:t.objectPointsPositionFactors,poseLandmarksLabels:t.poseLandmarksLabels,poseFilter:t.isPoseFilter?PoseFlipFilter.instance({}):null,NNsPaths:t.NNsPaths,threshold:t.threshold}).then(function(){_VTOMode=e,set_occluder()}).then(function(){_state=_states.idle})}function load_model(e,t){if(_state!==_states.running&&_state!==_states.idle||e===_VTOModel)return;_state=_states.busy;const n=_settings.models[e];HandTrackerThreeHelper.clear_threeObjects(!1),n.VTOMode===_VTOMode?new THREE.GLTFLoader(t).load(n.URL,function(e){const t=e.scene.children[0];if(t.scale.set(1,1,1),_settings.debugMeshMaterial&&t.traverse(function(e){e.material&&(e.material=new THREE.MeshNormalMaterial)}),n.scale&&t.scale.multiplyScalar(n.scale),n.offset){const e=n.offset,i=new THREE.Vector3(e[0],e[2],-e[1]);t.position.add(i)}if(n.quaternion){const e=n.quaternion;t.quaternion.set(e[0],e[2],-e[1],e[3])}HandTrackerThreeHelper.add_threeObject(t),_state=_states.running}):change_VTOMode(n.VTOMode).then(function(){load_model(e,t)})}function start(e){VTOCanvas.style.zIndex=3,setup_lighting(e),e.loadingManager.onLoad=function(){console.log("INFO in main.js: All THREE.js stuffs are loaded"),hide_loading(),_state=_states.running},_settings.debugWholeHand&&add_wholeHand(e.loadingManager),set_occluder().then(function(){_state=_states.idle}).then(function(){load_model(_settings.initialModel,e.loadingManager)})}function add_wholeHand(e){new THREE.GLTFLoader(e).load("assets/debug/debugHand.glb",function(e){const t=e.scene.children[0];t.traverse(function(e){e.material&&(e.material=new THREE.MeshNormalMaterial)}),HandTrackerThreeHelper.add_threeObject(t)})}function set_occluder(){const e=_settings.VTOModes[_VTOMode];return"SOFTCYLINDER"===e.occluderType?add_softOccluder(e):"MODEL"===e.occluderType?add_hardOccluder(e):Promise.resolve()}function add_hardOccluder(e){return new Promise(function(t,n){(new THREE.GLTFLoader).load(e.occluderModelURL,function(n){const i=n.scene.children[0];i.scale.multiplyScalar(e.occluderScale),_settings.debugOccluder?i.material=new THREE.MeshNormalMaterial:(HandTrackerThreeHelper.add_threeOccluder(i),t())})})}function add_softOccluder(e){const t=e.occluderRadiusRange[1],n=new THREE.Mesh(new THREE.CylinderGeometry(t,t,e.occluderHeight,32,1,!0),new THREE.MeshNormalMaterial),i=e.occluderRadiusRange[1]-e.occluderRadiusRange[0];return n.position.fromArray(e.occluderOffset),n.quaternion.fromArray(e.occluderQuaternion),n.scale.set(1,1,e.occluderFlattenCoeff),HandTrackerThreeHelper.add_threeSoftOccluder(n,t,i,_settings.debugOccluder),Promise.resolve()}function get_videoSettings(){return{facingMode:_isSelfieCam?"environment":"user"}}function flip_camera(){_state===_states.running&&is_mobileOrTablet()&&(_state=_states.busy,WEBARROCKSHAND.update_videoSettings(get_videoSettings()).then(function(){_isSelfieCam=!_isSelfieCam,_state=_states.running,set_canvasMirroring(_isSelfieCam),console.log("INFO in main.js: Camera flipped successfully")}).catch(function(e){console.log("ERROR in main.js: Cannot flip camera -",e)}))}function set_canvasMirroring(e){document.getElementById("canvases").style.transform=e?"rotateY(180deg)":""}function hide_loading(){const e=document.getElementById("loading");e.style.opacity=0,setTimeout(function(){e.parentNode.removeChild(e)},800)}function hide_instructions(){const e=document.getElementById("instructions");e&&(e.style.opacity=0,_isInstructionsHidden=!0,document.getElementById("controls").style.display="flex",setTimeout(function(){e.parentNode.removeChild(e)},800))}function callbackTrack(e){e.isDetected&&(_isInstructionsHidden||hide_instructions())}const NNPath="./WRRH/neuralNets/",NNWristVersion="27",NNRingVersion="14",NNWristBackVersion="1",NNRingBackVersion="6",wristModesCommonSettings={threshold:.95,poseLandmarksLabels:["wristBack","wristLeft","wristRight","wristPalm","wristPalmTop","wristBackTop","wristRightBottom","wristLeftBottom"],isPoseFilter:!0,occluderType:"SOFTCYLINDER",occluderRadiusRange:[3.5,4.5],occluderHeight:48,occluderOffset:[0,0,0],occluderQuaternion:[.707,0,0,.707],occluderFlattenCoeff:1,objectPointsPositionFactors:[1,1.3,1],landmarksStabilizerSpec:{minCutOff:.001,beta:5}},ringModesCommonSettings={threshold:.8,poseLandmarksLabels:["ringBack","ringLeft","ringRight","ringPalm","ringPalmTop","ringBackTop","ringBase0","ringBase1","ringMiddleFinger","ringPinkyFinger","ringBasePalm"],isPoseFilter:!0,occluderType:"MODEL",occluderModelURL:"static/glbs/yuzuk/Yuzuk.glb",occluderScale:2,objectPointsPositionFactors:[1,1,1],landmarksStabilizerSpec:{minCutOff:.001,beta:30}},wristModelCommonSettings={URL:"static/glbs/saat/Saat.glb",scale:1.9737,offset:[.076,-.916,-.504],quaternion:[0,0,0,1]},ringModelCommonSettings={URL:"static/glbs/yuzuk/Yuzuk.glb",scale:.421,offset:[-1.66,-11.91,.26],quaternion:[.258,.016,-.005,.966]},_settings={VTOModes:{wrist:Object.assign({NNsPaths:[NNPath+"NN_WRIST_"+NNWristVersion+".json"]},wristModesCommonSettings),wristBack:Object.assign({NNsPaths:[NNPath+"NN_WRISTBACK_"+NNWristBackVersion+".json"]},wristModesCommonSettings,{isPoseFilter:!1,threshold:.9}),ring:Object.assign({NNsPaths:[NNPath+"NN_RING_"+NNRingVersion+".json"]},ringModesCommonSettings),ringBack:Object.assign({NNsPaths:[NNPath+"NN_RINGBACK_"+NNRingBackVersion+".json"]},ringModesCommonSettings,{threshold:.8})},models:{wristDemo:Object.assign({VTOMode:"wrist"},wristModelCommonSettings),wristBackDemo:Object.assign({VTOMode:"wristBack"},wristModelCommonSettings),ringDemo:Object.assign({VTOMode:"ring"},ringModelCommonSettings),ringBackDemo:Object.assign({VTOMode:"ringBack"},ringModelCommonSettings)},initialModel:"ringDemo",debugDisplayLandmarks:!1,debugMeshMaterial:!1,debugOccluder:!1,debugWholeHand:!1};let _VTOMode=null,_VTOModel=null;const _states={notLoaded:-1,loading:0,idle:1,running:2,busy:3};let _state=_states.notLoaded,_isSelfieCam=!0,_isInstructionsHidden=!1;window.addEventListener("load",main);